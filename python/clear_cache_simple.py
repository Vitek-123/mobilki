"""
–ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
"""
import os
import sys
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

def clear_cache():
    """–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞"""
    print("=" * 60)
    print("–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")
    print("=" * 60)
    print()
    
    try:
        import redis
        
        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
        redis_client = redis.Redis(
            host=os.getenv("REDIS_HOST", "localhost"),
            port=int(os.getenv("REDIS_PORT", "6379")),
            db=int(os.getenv("REDIS_DB", "0")),
            decode_responses=True,
            socket_connect_timeout=2
        )
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        redis_client.ping()
        print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis —É—Å–ø–µ—à–Ω–æ")
        print()
        
        # –ü–æ–¥—Å—á–µ—Ç –∫–ª—é—á–µ–π –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π
        all_keys = redis_client.keys("*")
        keys_count = len(all_keys)
        print(f"üìä –ù–∞–π–¥–µ–Ω–æ –∫–ª—é—á–µ–π –≤ –∫—ç—à–µ: {keys_count}")
        
        if all_keys:
            # –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–π
            deleted = redis_client.delete(*all_keys)
            print(f"‚úÖ –£–¥–∞–ª–µ–Ω–æ –∫–ª—é—á–µ–π: {deleted}")
        else:
            print("‚ÑπÔ∏è –ö—ç—à —É–∂–µ –ø—É—Å—Ç")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞
        remaining_keys = redis_client.keys("*")
        if remaining_keys:
            print(f"‚ö†Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –∫–ª—é—á–µ–π: {len(remaining_keys)}")
        else:
            print("‚úÖ –í—Å–µ –∫–ª—é—á–∏ —É–¥–∞–ª–µ–Ω—ã")
            
    except (redis.ConnectionError, redis.TimeoutError, TimeoutError):
        print("‚ÑπÔ∏è Redis –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)")
        print("   –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ Redis –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è")
        print("   –ö—ç—à –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")
    except ImportError:
        print("‚ÑπÔ∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ redis –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")
        print("   –ö—ç—à –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {e}")
        print("   –ö—ç—à –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")
    
    print()
    print("=" * 60)
    print("‚úÖ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
    print("=" * 60)
    print()
    print("–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:")
    print("- –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à Android –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")
    print("- –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫—ç—à –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ, –µ—Å–ª–∏ Redis –¥–æ—Å—Ç—É–ø–µ–Ω")


if __name__ == "__main__":
    clear_cache()

