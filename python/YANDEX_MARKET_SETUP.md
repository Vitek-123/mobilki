# Настройка интеграции с Яндекс.Маркет API

## Требования

1. OAuth токен разработчика Яндекс.Маркет
2. Redis (опционально, для кэширования)

## Шаги настройки

### 1. Получение OAuth токена

#### Вариант 1: Использование скрипта (рекомендуется)

1. Зарегистрируйтесь на https://oauth.yandex.ru/
2. Создайте приложение
3. Получите Client ID и Client Secret
4. Настройте права доступа: `market:partner-api`
5. Укажите redirect URI: `http://localhost:8080` (для интерактивного способа)
6. Запустите скрипт:
   ```bash
   python get_oauth_token.py
   ```
7. Следуйте инструкциям на экране

#### Вариант 2: Ручное получение

1. Зарегистрируйтесь на https://oauth.yandex.ru/
2. Создайте приложение
3. Получите Client ID и Client Secret
4. Настройте права доступа: `market:partner-api`
5. Откройте в браузере:
   ```
   https://oauth.yandex.ru/authorize?response_type=code&client_id=ВАШ_CLIENT_ID
   ```
6. Авторизуйтесь и разрешите доступ
7. Скопируйте код из параметра `code` в URL
8. Обменяйте код на токен:
   ```bash
   curl -X POST https://oauth.yandex.ru/token \
     -d "grant_type=authorization_code" \
     -d "code=ВАШ_КОД" \
     -d "client_id=ВАШ_CLIENT_ID" \
     -d "client_secret=ВАШ_CLIENT_SECRET"
   ```

### 2. Настройка переменных окружения

Добавьте в файл `.env`:

```env
# Яндекс.Маркет OAuth API
YANDEX_OAUTH_TOKEN=ваш_oauth_токен
YANDEX_MARKET_CAMPAIGN_ID=опционально_если_есть
```

### 3. Проверка работы

После настройки токена:
1. Перезапустите сервер
2. Проверьте логи - должно появиться сообщение "✅ Яндекс.Маркет OAuth API инициализирован"
3. Попробуйте получить популярные товары через `/products/popular`

## Как это работает

1. **Получение товаров**: При запросе популярных товаров система:
   - Проверяет кэш Redis
   - Если кэша нет, запрашивает товары из Яндекс.Маркет API
   - Сохраняет в кэш на 1 час
   - Объединяет с товарами из MySQL БД

2. **Кнопка "Купить"**: 
   - Для товаров из Яндекс.Маркет: открывает URL товара на Яндекс.Маркет
   - Для товаров из БД: открывает URL из таблицы `listings`
   - Если URL нет: открывает поиск в Яндекс.Маркет

## Структура данных

Товары из Яндекс.Маркет содержат:
- `title` - название товара
- `brand` - бренд
- `model` - модель
- `price` - цена
- `url` - ссылка на товар в Яндекс.Маркет
- `image` - изображение товара
- `description` - описание

## Примечания

- API ограничивает количество товаров до 30 за запрос
- Кэш популярных товаров хранится 1 час
- Если OAuth токен не настроен, система будет работать только с данными из БД

