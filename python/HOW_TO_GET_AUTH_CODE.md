# Как получить код авторизации для Яндекс.Маркет API

## Пошаговая инструкция

### Шаг 1: Создайте приложение на Яндекс OAuth

1. Перейдите на https://oauth.yandex.ru/
2. Войдите в свой аккаунт Яндекс
3. Нажмите **"Создать новое приложение"**
4. Заполните форму:
   - **Название**: например, "ScanPrice" или "Мой агрегатор цен"
   - **Платформы**: выберите "Веб-сервисы"
   - **Redirect URI**: `http://localhost:8080` (для интерактивного способа) или `https://oauth.yandex.ru/verification_code` (для ручного)
5. Нажмите **"Создать"**

### Шаг 2: Настройте права доступа

1. В настройках приложения найдите раздел **"Права доступа"**
2. Включите право: **`market:partner-api`** (для работы с Яндекс.Маркет API)
3. Сохраните изменения

### Шаг 3: Получите Client ID и Client Secret

1. В настройках приложения найдите:
   - **Client ID** — это идентификатор приложения (например, `5c11d50c52304b16b6c07fbb6b5382d8`)
   - **Client Secret** — это секретный ключ (показывается один раз при создании, например, `63f8b8c7e1d74543affdab9cde21c14b`)

⚠️ **Важно**: Client Secret показывается только один раз! Сохраните его сразу.

### Шаг 4: Получите код авторизации

#### Способ 1: Автоматический (рекомендуется)

1. Запустите скрипт:
   ```bash
   python get_oauth_token.py
   ```
2. Введите Client ID и Client Secret
3. Выберите способ **"1"** (интерактивный)
4. Скрипт автоматически:
   - Откроет браузер
   - Вы перейдете на страницу авторизации Яндекс
   - Авторизуетесь и разрешите доступ
   - Код будет получен автоматически

#### Способ 2: Ручной

1. Сформируйте URL для авторизации:
   ```
   https://oauth.yandex.ru/authorize?response_type=code&client_id=ВАШ_CLIENT_ID
   ```
   
   Замените `ВАШ_CLIENT_ID` на ваш реальный Client ID.

2. Откройте этот URL в браузере

3. Войдите в аккаунт Яндекс (если не вошли)

4. Разрешите доступ приложению (нажмите "Разрешить")

5. После авторизации вас перенаправит на страницу с кодом

6. **Код авторизации будет в URL** в параметре `code`:
   ```
   http://localhost:8080/?code=65zwn4r2ggkamkod
   ```
   
   Или если использовали `https://oauth.yandex.ru/verification_code`:
   ```
   https://oauth.yandex.ru/verification_code?code=65zwn4r2ggkamkod
   ```

7. Скопируйте код из URL (в примере это `65zwn4r2ggkamkod`)

### Шаг 5: Обменяйте код на токен

После получения кода авторизации:

1. Запустите скрипт:
   ```bash
   python exchange_code_for_token.py
   ```
2. Введите:
   - Код авторизации (который вы скопировали)
   - Client ID
   - Client Secret
3. Скрипт обменяет код на токен и сохранит в `.env`

## Пример полного процесса

```
1. Создаете приложение → получаете Client ID и Client Secret
2. Открываете URL: https://oauth.yandex.ru/authorize?response_type=code&client_id=ВАШ_ID
3. Авторизуетесь и разрешаете доступ
4. Копируете код из URL: 65zwn4r2ggkamkod
5. Обмениваете код на токен через exchange_code_for_token.py
6. Токен сохраняется в .env
```

## Важные моменты

- ⚠️ Код авторизации действует **только 10 минут**! Обменяйте его сразу.
- ⚠️ Client Secret показывается **только один раз** при создании приложения.
- ✅ Токен действует долго (обычно несколько месяцев или лет).
- ✅ После получения токена код авторизации больше не нужен.

## Если что-то пошло не так

- **"Ошибка доступа"**: Проверьте, что включено право `market:partner-api`
- **"Неверный код"**: Код мог истечь (действует 10 минут), получите новый
- **"Неверный Client Secret"**: Убедитесь, что скопировали правильно

